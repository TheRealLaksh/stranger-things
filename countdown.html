<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Episode Release — Countdown</title>
    <link rel="icon" type="image/jpeg" href="assets/images/favicon.jpg">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Black+Ops+One&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --red: #ff2a2a;
            --dark: #050404;
            --panel: #120808;
            --glow: 0 0 18px rgba(255, 40, 40, 0.95), 0 0 40px rgba(255, 40, 40, 0.6);
        }

        html,
        body {
            height: 100%;
            margin: 0;
            background: #000;
            overflow: hidden;
            font-family: "Courier Prime", monospace;
            color: var(--red);
            -webkit-font-smoothing: antialiased
        }

        /* Container */
        .wrap {
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            box-sizing: border-box
        }

        /* Spores / particles */
        .spore {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(255, 0, 0, 0.85);
            filter: blur(0.4px);
            mix-blend-mode: screen;
            opacity: 0.9;
            z-index: 2
        }

        /* CRT + grain + vignette */
        .crt {
            pointer-events: none;
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.02) 2px, transparent 2px, transparent 4px);
            opacity: 0.14;
            z-index: 30
        }

        .grain {
            pointer-events: none;
            position: absolute;
            inset: 0;
            background-image: url('https://i.imgur.com/o9K4rEW.png');
            opacity: 0.07;
            mix-blend-mode: overlay;
            animation: noise .25s steps(3) infinite;
            z-index: 29
        }

        @keyframes noise {
            0% {
                transform: translate(0, 0)
            }

            25% {
                transform: translate(-3px, 2px)
            }

            50% {
                transform: translate(2px, -2px)
            }

            75% {
                transform: translate(-2px, 1px)
            }

            100% {
                transform: translate(0, 0)
            }
        }

        .vignette {
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(ellipse at 50% 40%, rgba(0, 0, 0, 0) 30%, rgba(0, 0, 0, 0.5) 60%, rgba(0, 0, 0, 0.85) 100%);
            z-index: 15
        }

        /* Poster & silhouette */
        .poster-wrap {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 50
        }

        #poster {
            width: 460px;
            border: 3px solid var(--red);
            border-radius: 6px;
            box-shadow: 0 0 45px rgba(255, 40, 40, 0.65);
            transform-origin: center center;
            transition: transform 1s;
            z-index: 50;
            cursor: pointer;
            display: block
        }

        /* subtle silhouette behind poster */
        .silhouette {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -52%);
            width: 520px;
            height: 300px;
            opacity: 0.07;
            background: radial-gradient(ellipse at 50% 30%, rgba(255, 20, 20, 0.35), transparent 35%);
            filter: blur(16px);
            mix-blend-mode: screen;
            z-index: 45;
            pointer-events: none
        }

        /* Title + electric arc */
        .title {
            font-family: "Black Ops One", cursive;
            font-size: 3.2rem;
            letter-spacing: 3px;
            margin-top: 18px;
            text-shadow: 0 0 15px rgba(255, 30, 30, 0.9);
            position: relative;
            z-index: 60
        }

        .electric {
            position: absolute;
            inset: -6px;
            pointer-events: none;
            mix-blend-mode: screen;
            filter: blur(6px);
            opacity: 0.7;
            animation: arc 3s ease-in-out infinite
        }

        @keyframes arc {
            0% {
                box-shadow: 0 0 6px rgba(255, 80, 80, 0.3)
            }

            50% {
                box-shadow: 0 0 30px rgba(255, 50, 50, 0.95)
            }

            100% {
                box-shadow: 0 0 6px rgba(255, 80, 80, 0.3)
            }
        }

        /* Label */
        .label {
            color: #cfcfcf;
            font-size: 1.05rem;
            margin-top: 10px;
            z-index: 60
        }

        /* Timer (big) */
        .countdown {
            margin-top: 18px;
            background: linear-gradient(180deg, #190101, #080404);
            padding: 36px 60px;
            border-radius: 14px;
            border: 3px solid var(--red);
            box-shadow: var(--glow);
            text-align: center;
            z-index: 60;
            min-width: 680px;
            display: inline-block
        }

        .digits {
            font-family: "Black Ops One", cursive;
            font-size: 4.8rem;
            color: #ffb3b3;
            letter-spacing: 6px;
            display: flex;
            gap: 14px;
            justify-content: center;
            align-items: center
        }

        .digit {
            display: inline-block;
            min-width: 90px;
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px dashed rgba(255, 255, 255, 0.04);
            background: linear-gradient(180deg, rgba(255, 0, 0, 0.03), transparent);
            box-shadow: 0 0 22px rgba(255, 30, 30, 0.06) inset;
            transform-origin: center;
            transition: transform .12s
        }

        .digit span {
            display: inline-block;
            transform: translateZ(0)
        }

        /* small label under */
        .release-info {
            font-size: 0.95rem;
            color: #9e9e9e;
            margin-top: 12px
        }

        /* Buttons */
        .controls {
            margin-top: 22px;
            display: flex;
            gap: 18px;
            align-items: center;
            z-index: 60
        }

        .btn {
            background: #0b0b0b;
            border: 2px solid var(--red);
            color: var(--red);
            padding: 10px 18px;
            border-radius: 6px;
            cursor: pointer;
            transition: all .18s;
            font-weight: 700
        }

        .btn:hover {
            background: var(--red);
            color: #000;
            transform: scale(1.04)
        }

        .panic {
            background: linear-gradient(180deg, #3b0000, #120000);
            box-shadow: 0 0 18px rgba(255, 10, 10, 0.4)
        }

        /* glitch fracture */
        .fracture {
            animation: fract 0.9s steps(4) infinite;
            display: inline-block
        }

        @keyframes fract {
            0% {
                opacity: 1;
                transform: translateX(0)
            }

            25% {
                transform: translateX(3px)
            }

            50% {
                transform: translateX(-2px)
            }

            75% {
                transform: translateX(2px)
            }

            100% {
                transform: translateX(0)
            }
        }

        /* shake on tick */
        .shake {
            animation: shakeit .14s ease-in-out
        }

        @keyframes shakeit {
            0% {
                transform: translateY(0)
            }

            25% {
                transform: translateY(-3px)
            }

            50% {
                transform: translateY(0)
            }

            75% {
                transform: translateY(-2px)
            }

            100% {
                transform: translateY(0)
            }
        }

        /* small footer */
        .note {
            margin-top: 12px;
            color: #7e7e7e;
            font-size: .9rem;
            z-index: 60
        }

        /* reflection (upside-down mirror) */
        .reflection {
            position: fixed;
            left: 0;
            right: 0;
            bottom: -18vh;
            height: 40vh;
            transform: scaleY(-1) translateY(12vh);
            opacity: 0.06;
            filter: blur(6px) saturate(.6);
            z-index: 10;
            pointer-events: none;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.85), transparent)
        }

        /* VHS tracking distortion pseudo overlay */
        .vhs {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 70;
            mix-blend-mode: screen
        }

        .vhs::before,
        .vhs::after {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #222, transparent);
            opacity: 0.08;
            transform: translateY(0)
        }

        .vhs::before {
            top: 20%
        }

        .vhs::after {
            top: 60%
        }

        .vhsshake {
            animation: vhsshake .6s linear infinite
        }

        @keyframes vhsshake {
            0% {
                transform: translateX(-1px)
            }

            50% {
                transform: translateX(1px)
            }

            100% {
                transform: translateX(-1px)
            }
        }

        /* preloader intro */
        .preloader {
            position: fixed;
            inset: 0;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            transition: opacity .6s
        }

        .preloader.hidden {
            opacity: 0;
            pointer-events: none
        }

        .preloader .bar {
            width: 360px;
            height: 8px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.06);
            overflow: hidden
        }

        .preloader .bar .fill {
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, var(--red), #ff6b6b);
            animation: fill 1.8s forwards
        }

        @keyframes fill {
            0% {
                width: 0
            }

            100% {
                width: 100%
            }
        }

        /* Upside-Down (panic) mode */
        .upsidedown {
            filter: invert(1) hue-rotate(180deg) saturate(1.2) contrast(1.1);
            transform: scaleY(-1) rotate(180deg)
        }

        .upsidedown .poster {
            transform: scaleY(-1)
        }

        /* a heavy distortion overlay */
        .upsidedown::after {
            content: "";
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(45deg, rgba(255, 0, 0, 0.02), rgba(255, 0, 0, 0.02) 2px, transparent 2px, transparent 4px);
            mix-blend-mode: overlay;
            opacity: 0.28;
            pointer-events: none
        }

        /* ripple effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.02) 40%, transparent 60%);
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 80
        }

        /* Morse overlay */
        .morse-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.88);
            color: #cfcfcf;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            padding: 28px;
            text-align: center;
            z-index: 1000;
            opacity: 0;
            transform: translateY(8px);
            transition: all .3s
        }

        .morse-overlay.show {
            opacity: 1;
            transform: translateY(0)
        }

        /* small responsiveness */
        @media (max-width:820px) {
            .countdown {
                min-width: 92vw;
                padding: 28px
            }

            .digits {
                font-size: 3.2rem;
                gap: 8px
            }

            .digit {
                min-width: 56px
            }

            #poster {
                width: 320px
            }

            .title {
                font-size: 2rem
            }
        }
    </style>
</head>

<body>

    <div id="preloader" class="preloader">
        <div style="text-align:center;color:#aaa;margin-bottom:12px;font-size:0.9rem">Hawkins Archive — Initializing
        </div>
        <div class="bar">
            <div class="fill"></div>
        </div>
    </div>

    <div id="root" class="wrap" aria-hidden="false">

        <div class="silhouette" id="sil"></div>

        <div class="poster-wrap" id="posterWrap">
            <img id="poster" src="" alt="Episode poster" />
        </div>

        <div class="title" id="titleWrap">CASE — LOADING<span class="electric"></span></div>

        <div class="label">RELEASE IN</div>

        <div class="countdown" id="countdownBox" role="status" aria-live="polite">
            <div class="digits" id="digits">
                <div class="digit" id="d-days"><span>0d</span></div>
                <div class="digit" id="d-hours"><span>0h</span></div>
                <div class="digit" id="d-mins"><span>0m</span></div>
                <div class="digit" id="d-secs"><span>0s</span></div>
            </div>
            <div class="release-info" id="releaseInfo">Releasing on: —</div>
        </div>

        <div class="controls">
            <button class="btn" id="backBtn">← RETURN TO ARCHIVE</button>
            <button class="btn panic" id="panicBtn">PANIC (Toggle Upside-Down)</button>
        </div>

        <div class="note">Tip: Click poster quickly 5× for a hidden message</div>

        <div class="reflection"></div>
        <div class="vhs vhsshake" id="vhs"></div>
        <div class="vhs" id="vhs2"></div>

        <div class="crt"></div>
        <div class="grain"></div>
        <div class="vignette"></div>

        <!-- Morse secret -->
        <div id="morse" class="morse-overlay">— · — · — · — · — (SECRET MESSAGE: STAY VIGILANT)</div>
    </div>

    <!-- extra elements -->
    <div id="breachFlash" style="position:fixed;inset:0;background:#fff;opacity:0;pointer-events:none;z-index:9999">
    </div>
    <div id="audioHint" aria-hidden="true" style="display:none"></div>

    <!-- small script to populate + animate -->
    <script>
        (() => {
            // -------------------------
            // Utilities & DOM refs
            // -------------------------
            const params = new URLSearchParams(window.location.search);
            const ep = parseInt(params.get('ep') || '5', 10);
            const poster = document.getElementById('poster');
            const titleWrap = document.getElementById('titleWrap');
            const releaseInfo = document.getElementById('releaseInfo');
            const digits = {
                days: document.getElementById('d-days'),
                hours: document.getElementById('d-hours'),
                mins: document.getElementById('d-mins'),
                secs: document.getElementById('d-secs')
            };
            const countdownBox = document.getElementById('countdownBox');
            const preloader = document.getElementById('preloader');
            const root = document.getElementById('root');
            const panicBtn = document.getElementById('panicBtn');
            const backBtn = document.getElementById('backBtn');
            const morseOverlay = document.getElementById('morse');

            // Episode metadata
            const titles = {
                5: "CASE 05 — SHOCK JOCK",
                6: "CASE 06 — CAMAZOTZ",
                7: "CASE 07 — THE BRIDGE",
                8: "CASE 08 — RIGHTSIDE UP"
            };
            const posterPath = `assets/images/ep${ep}.jpg`;

            // release times (IST)
            const releaseTime = (ep === 8) ?
                new Date("2025-12-31T23:00:00+05:30") :
                new Date("2025-12-25T06:30:00+05:30");

            // populate UI
            poster.src = posterPath;
            titleWrap.textContent = titles[ep];
            releaseInfo.textContent = 'Releasing on: ' + releaseTime.toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' }) + ' IST';

            // reflection background uses poster as background (cheap)
            document.querySelector('.reflection').style.backgroundImage = `url("${posterPath}")`;
            document.querySelector('.reflection').style.backgroundSize = 'cover';
            document.querySelector('.reflection').style.backgroundPosition = 'center';

            // -------------------------
            // Preloader intro
            // -------------------------
            setTimeout(() => { preloader.classList.add('hidden'); setTimeout(() => preloader.style.display = 'none', 700) }, 1400);

            // -------------------------
            // Particles (spores)
            // -------------------------
            function spawnSpores(n = 10) {
                for (let i = 0; i < n; i++) {
                    const s = document.createElement('div');
                    s.className = 'spore';
                    const left = Math.random() * 92 + 3;
                    const top = Math.random() * 82 + 6;
                    s.style.left = left + '%';
                    s.style.top = top + '%';
                    const dur = 5 + Math.random() * 8;
                    s.style.animation = `float ${dur}s ${(Math.random() * 2)}s ease-in-out infinite`;
                    document.body.appendChild(s);
                    // subtle movement over time
                    setTimeout(() => { s.style.opacity = 0.95 }, 50);
                }
            }
            spawnSpores(14);

            // -------------------------
            // WebAudio: hum + beep + morse
            // -------------------------
            const AudioCtx = window.AudioContext || window.webkitAudioContext;
            const audioCtx = AudioCtx ? new AudioCtx() : null;
            let humGain, humOsc;
            if (audioCtx) {
                humOsc = audioCtx.createOscillator();
                humOsc.type = 'sine';
                humOsc.frequency.value = 40; // low hum
                humGain = audioCtx.createGain();
                humGain.gain.value = 0.0008; // tiny start
                humOsc.connect(humGain);
                humGain.connect(audioCtx.destination);
                humOsc.start();
            }

            function setHumStrength(norm) { // norm 0..1
                if (!humGain) return;
                humGain.gain.setTargetAtTime(0.0008 + norm * 0.03, audioCtx.currentTime, 0.2);
            }

            function playBeep(freq = 880, time = 0.06) {
                if (!audioCtx) return;
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.type = 'sine'; o.frequency.value = freq;
                g.gain.value = 0;
                o.connect(g); g.connect(audioCtx.destination);
                g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
                g.gain.linearRampToValueAtTime(0.12, audioCtx.currentTime + 0.008);
                o.start();
                setTimeout(() => { g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + time); setTimeout(() => o.stop(), time * 1000 + 30) }, time * 1000);
            }

            // morse: DOT=. DASH=-, timings in ms
            function playMorse(msg) {
                if (!audioCtx) return;
                const unit = 0.12;
                const now = audioCtx.currentTime;
                let t = now;
                for (const ch of msg) {
                    if (ch === '.') {
                        const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
                        o.type = 'sine'; o.frequency.value = 900; g.gain.value = 0; o.connect(g); g.connect(audioCtx.destination);
                        o.start(t); g.gain.linearRampToValueAtTime(0.12, t + 0.005); g.gain.linearRampToValueAtTime(0.0001, t + unit); o.stop(t + unit + 0.02);
                        t += unit + 0.06;
                    } else if (ch === '-') {
                        const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
                        o.type = 'sine'; o.frequency.value = 900; g.gain.value = 0; o.connect(g); g.connect(audioCtx.destination);
                        o.start(t); g.gain.linearRampToValueAtTime(0.12, t + 0.005); g.gain.linearRampToValueAtTime(0.0001, t + unit * 3); o.stop(t + unit * 3 + 0.02);
                        t += unit * 3 + 0.06;
                    } else {
                        t += unit * 2;
                    }
                }
            }

            // -------------------------
            // Timer logic + animations
            // -------------------------
            function padNum(n) { return String(n) }
            let tickShakeTimer = null;
            function tickAnimations(diff) {
                // increase hum as time decreases:
                const total = Math.max(1, releaseTime - Date.now());
                const remainNorm = Math.min(1, Math.max(0, 1 - (diff / (1000 * 60 * 60 * 24 * 30)))); // roughly scales over ~30 days
                setHumStrength(remainNorm);

                // occasional fracture glitch
                if (Math.random() < 0.06) {
                    const els = document.querySelectorAll('.digit');
                    els[Math.floor(Math.random() * els.length)].classList.add('fracture');
                    setTimeout(() => els.forEach(el => el.classList.remove('fracture')), 900);
                }
                // shake on each second tick
                countdownBox.classList.add('shake');
                clearTimeout(tickShakeTimer);
                tickShakeTimer = setTimeout(() => countdownBox.classList.remove('shake'), 140);
            }

            function update() {
                const now = Date.now();
                let diff = releaseTime - now;
                if (diff <= 0) {
                    // available now
                    document.getElementById('digits').style.opacity = '0';
                    document.getElementById('releaseInfo').textContent = 'AVAILABLE — Redirecting...';
                    // animate breach flash + beep + VHS rewind
                    document.getElementById('breachFlash').style.transition = 'opacity .12s';
                    document.getElementById('breachFlash').style.opacity = 1;
                    if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
                    playBeep(1200, 0.08);
                    setTimeout(() => { document.getElementById('breachFlash').style.opacity = 0 }, 200);
                    // VHS rewind animation: shrink + blur
                    document.body.style.transition = 'filter 0.9s, transform 0.9s';
                    document.body.style.filter = 'grayscale(1) blur(2px)';
                    document.body.style.transform = 'scale(.98) translateY(-4vh)';
                    // redirect after short delay
                    setTimeout(() => { window.location.href = `player.html?src=assets/episodes/ep${ep}.mp4`; }, 1100);
                    return;
                }

                // compute time parts
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                diff -= days * (1000 * 60 * 60 * 24);
                const hours = Math.floor(diff / (1000 * 60 * 60));
                diff -= hours * (1000 * 60 * 60);
                const mins = Math.floor(diff / (1000 * 60));
                diff -= mins * (1000 * 60);
                const secs = Math.floor(diff / 1000);

                // set digits (wrap each in span to allow per-digit animation)
                function setDigit(el, val, suffix) {
                    const s = el.querySelector('span');
                    if (!s) return;
                    s.textContent = `${val}${suffix}`;
                    // pulse animation for this el
                    el.style.transform = 'scale(1.06)';
                    setTimeout(() => el.style.transform = 'scale(1)', 120);
                }
                setDigit(digits.days, days, 'd');
                setDigit(digits.hours, hours, 'h');
                setDigit(digits.mins, mins, 'm');
                setDigit(digits.secs, secs, 's');

                // visual + audio react
                tickAnimations(releaseTime - Date.now());

                requestAnimationFrame(() => setTimeout(update, 1000 - (Date.now() % 1000)));
            }

            // start update loop after small delay to allow page paint
            setTimeout(() => { update(); }, 600);

            // -------------------------
            // poster ripple + hover effects
            // -------------------------
            const posterWrap = document.getElementById('posterWrap');
            posterWrap.addEventListener('mousemove', (e) => {
                const r = posterWrap.getBoundingClientRect();
                const cx = e.clientX - r.left - r.width / 2;
                const cy = e.clientY - r.top - r.height / 2;
                // subtle parallax
                poster.style.transform = `translate(${cx * 0.02}px,${cy * 0.02}px) scale(1.01)`;
                // "psychic ripple" -- move vignette slightly
                document.querySelector('.vignette').style.backgroundPosition = `${50 - cx * 0.01}% ${40 - cy * 0.02}%`;
            });
            posterWrap.addEventListener('mouseleave', () => { poster.style.transform = 'scale(1)'; document.querySelector('.vignette').style.backgroundPosition = '50% 40%'; });

            // ripple on click location
            posterWrap.addEventListener('click', (ev) => {
                const r = posterWrap.getBoundingClientRect();
                const x = ev.clientX - r.left;
                const y = ev.clientY - r.top;
                const rip = document.createElement('div');
                rip.className = 'ripple';
                rip.style.left = (x + r.left) + 'px';
                rip.style.top = (y + r.top) + 'px';
                rip.style.width = '20px'; rip.style.height = '20px'; rip.style.opacity = 0.9;
                document.body.appendChild(rip);
                // expand
                rip.animate([{ transform: 'translate(-50%,-50%) scale(1)', opacity: 1 }, { transform: 'translate(-50%,-50%) scale(18)', opacity: 0 }], { duration: 900, easing: 'cubic-bezier(.2,.8,.2,1)' });
                setTimeout(() => rip.remove(), 920);

                // resume audio context if needed
                if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
            });

            // -------------------------
            // Panic: toggle Upside-Down mode
            // -------------------------
            panicBtn.addEventListener('click', () => {
                root.classList.toggle('upsidedown');
                // add a small audio chirp
                if (audioCtx) { playBeep(600, 0.06); playBeep(480, 0.05); }
            });

            backBtn.addEventListener('click', () => { window.location.href = 'library.html'; });

            // -------------------------
            // marquee / vhs flicker small randomization
            // -------------------------
            setInterval(() => {
                const v = document.getElementById('vhs');
                v.style.opacity = (0.04 + Math.random() * 0.06);
                v.classList.toggle('vhsshake', Math.random() > 0.3);
            }, 400);

            // -------------------------
            // Morse easter: click poster 5x quick
            // -------------------------
            let clickCount = 0, clickTimer = null;
            posterWrap.addEventListener('click', () => {
                clickCount++;
                clearTimeout(clickTimer);
                clickTimer = setTimeout(() => { clickCount = 0; }, 1100);
                if (clickCount >= 5) {
                    clickCount = 0;
                    // show morse overlay
                    morseOverlay.classList.add('show');
                    setTimeout(() => morseOverlay.classList.remove('show'), 4200);
                    // play morse (example: S T A Y -> ... - .- -.-- )
                    if (audioCtx) playMorse('... - .- -.--');
                }
            });

            // -------------------------
            // occasional subtle flashes as time decreases
            // -------------------------
            setInterval(() => {
                const remaining = releaseTime - Date.now();
                const pct = Math.max(0, Math.min(1, 1 - remaining / (1000 * 60 * 60 * 24 * 14))); // more frequent in last 14 days
                if (Math.random() < pct * 0.08) {
                    document.querySelector('.electric').style.opacity = 1;
                    setTimeout(() => document.querySelector('.electric').style.opacity = 0.7, 180);
                }
            }, 1000);

            // -------------------------
            // small accessibility: resume audio on first user gesture
            // -------------------------
            function resumeOnGesture() {
                if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
                document.removeEventListener('click', resumeOnGesture);
                document.removeEventListener('keydown', resumeOnGesture);
            }
            document.addEventListener('click', resumeOnGesture);
            document.addEventListener('keydown', resumeOnGesture);

            // -------------------------
            // start with small intro effect
            // -------------------------
            setTimeout(() => { document.getElementById('digits').classList.add('fracture'); setTimeout(() => document.getElementById('digits').classList.remove('fracture'), 900) }, 800);
        })();
    </script>

</body>

</html>